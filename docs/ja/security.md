# セキュリティ

このドキュメントは `dvcx` に実装されているセキュリティ対策について説明します。

## 認証

### OAuth2 トークン管理

- トークンは `https://auth.devcycle.com/oauth/token` からOAuth2クライアントクレデンシャルフローで取得されます
- トークンは制限されたファイル権限（0600）で `.devcycle/token` にローカル保存されます
- `.devcycle/` ディレクトリは制限された権限（0700）で作成されます
- トークンは期限切れ時に自動的に更新されます
- すべてのAPI通信はHTTPSを使用します

### 認証情報の保存

- クライアントクレデンシャル（`client_id` と `client_secret`）は `.devcycle/config.yaml` に保存されます
- `.devcycle/` ディレクトリは `.gitignore` でバージョン管理から除外されています
- トークンはプレーンテキストで保存されますが、ファイル権限は制限されています

## 入力検証

### URLパスエスケープ

すべてのユーザー提供パスパラメータは `url.PathEscape()` でエスケープされ、以下を防止します：

- パストラバーサル攻撃
- URLインジェクション
- 特殊文字の操作

これは以下を含むすべてのAPIエンドポイントに適用されます：

- プロジェクトキー
- フィーチャーキー
- 環境キー
- 変数キー
- Webhook ID
- メトリクスキー
- オーディエンスキー
- カスタムプロパティキー

### クエリパラメータエスケープ

クエリパラメータはインジェクション攻撃を防ぐために `url.QueryEscape()` でエスケープされます。

### ファイルサイズ制限

メモリ枯渇によるサービス拒否攻撃を防ぐため：

- JSON入力ファイルは最大10MBに制限されています
- 標準入力は `io.LimitReader` を使用して制限されています
- ファイルサイズは読み込み前にチェックされます

## ネットワークセキュリティ

### HTTPSのみ

- すべてのAPI通信はHTTPSを使用します
- ベースURL: `https://api.devcycle.com/v1`
- 認証URL: `https://auth.devcycle.com/oauth/token`

### リクエストタイムアウト

- すべてのAPIリクエストには30秒のタイムアウトがあります
- 接続のハングを防止します

## ユーザー向けベストプラクティス

### 認証情報を保護する

1. **認証情報をコミットしない** - `.devcycle/` ディレクトリは `.gitignore` に含まれています
2. **環境変数を使用する** - CI/CDでは `DVCX_CLIENT_ID` と `DVCX_CLIENT_SECRET` を使用してください
3. **認証情報をローテーションする** - DevCycleクライアントクレデンシャルを定期的にローテーションしてください

### 環境を保護する

1. **ファイル権限** - `.devcycle/` に制限された権限があることを確認してください
2. **共有システム** - 共有システムで `dvcx` を使用する場合は注意してください
3. **CI/CDシークレット** - CI/CDプラットフォームのシークレット管理を使用してください

## セキュリティ問題の報告

セキュリティの脆弱性を発見した場合は、GitHubでプライベートセキュリティアドバイザリを作成するか、メンテナーに直接連絡して報告してください。

セキュリティの脆弱性に関する公開Issueは作成**しないでください**。
